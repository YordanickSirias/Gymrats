<!doctype html>
<html lang="es">
<head>
  <title>{% block title %}{% endblock title %}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="{{ url_for('static', filename='logo_gymrats.png') }}" type="image/x-icon">

  <!-- CSS: Bootstrap + librerías -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

  <style>
    :root{
      --rojo:#c40000; --rojo-dark:#7a0000; --rojo-soft:#ff4d4d;
      --gris-bg:#f5f6f7; --texto:#222;
    }
    *{box-sizing:border-box;}
    body{
      background:var(--gris-bg);
      font-family:'Poppins', system-ui, Arial, sans-serif;
      color:var(--texto); margin:0; min-height:100vh; display:flex; flex-direction:column;
    }
    /* NAVBAR */
    .navbar{ background:linear-gradient(90deg,var(--rojo-dark),var(--rojo)); box-shadow:0 4px 14px -4px rgba(0,0,0,.35); padding:.65rem 0; }
    .navbar.navbar-dark .navbar-toggler{ border-color: rgba(255,255,255,.25); }
    .navbar-brand{ font-weight:700; letter-spacing:.5px; color:#fff !important; display:flex; align-items:center; gap:.55rem; }
    .navbar-brand img{ width:44px; height:44px; border-radius:8px; object-fit:cover; box-shadow:0 0 0 3px rgba(255,255,255,.15); }
    .main-nav{ display:flex; gap:.35rem; }
    .main-nav .nav-link{ color:#fff !important; font-weight:600; padding:.55rem 1.05rem; border-radius:30px; transition:.25s; }
    .main-nav .nav-link:hover,.main-nav .nav-link:focus{ background:rgba(255,255,255,.12); color:#fff !important; }
    .main-nav .nav-link.active{ background:#fff; color:var(--rojo-dark) !important; box-shadow:0 2px 8px -2px rgba(0,0,0,.3); }
    .navbar .dropdown-menu{ border-radius:12px; border:1px solid #eee; box-shadow:0 10px 24px -12px rgba(0,0,0,.25); }
    /* Caja derecha */
    .login-box{ display:flex; align-items:center; gap:.75rem; color:#fff; }
    .login-box .welcome{ font-weight:600; letter-spacing:.3px; }
    .btn-login{ background:#fff; color:var(--rojo-dark); font-weight:600; border:none; padding:.55rem 1.15rem; border-radius:40px; letter-spacing:.4px; box-shadow:0 4px 12px -4px rgba(0,0,0,.35); transition:.3s; text-transform:uppercase; }
    .btn-login:hover{ background:var(--rojo-soft); color:#fff; transform:translateY(-2px); }
    main{ flex:1 0 auto; width:100%; padding-bottom:30px; }
    footer{ background:#111; color:#e8e8e8; margin-top:auto; padding:40px 0 12px; }
    .copyright{ font-size:.7rem; text-align:center; opacity:.75; letter-spacing:.6px; padding-top:8px; border-top:1px solid rgba(255,255,255,.08); }
    @media (max-width: 991px){ .main-nav{ flex-direction:column; padding:1rem 0; } .login-box{ margin-top:.75rem; } .btn-login{ width:100%; } }
  </style>
</head>
<body>

  <!-- Toasts (global ADMIN) -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index:1100;">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="toast align-items-center border-0 {% if category in ['success','warning','danger','info','primary','secondary','dark'] %}text-bg-{{ category }}{% else %}text-bg-dark{% endif %}"
             role="alert" aria-live="assertive" aria-atomic="true"
             data-bs-autohide="true" data-bs-delay="2200">
          <div class="d-flex">
            <div class="toast-body">{{ message }}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
    {% endwith %}
  </div>

  <!-- NAV -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('admin') }}">
        <img src="{{ url_for('static', filename='logo_gymrats.png') }}" alt="GymRats"> GYMRATS
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navAdmin" aria-controls="navAdmin" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-center" id="navAdmin">
        <!-- Menú central -->
        <ul class="navbar-nav main-nav mx-auto">
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint=='admin' %}active{% endif %}" href="{{ url_for('admin') }}">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint=='dashboard' %}active{% endif %}" href="{{ url_for('dashboard') }}">Dashboard</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle {% if 'productos' in request.endpoint %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Productos
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{{ url_for('listar_productos_agregados') }}">Agregar</a></li>
              <li><a class="dropdown-item" href="{{ url_for('listar_productos') }}">Listar</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint=='listar' %}active{% endif %}" href="{{ url_for('listar') }}">Usuarios</a>
          </li>
        </ul>

        <!-- Derecha -->
        <div class="login-box">
          {% if session.get('nombre') %}
            <span class="welcome d-none d-md-inline">Bienvenid@, {{ session['nombre'] }}</span>
          {% endif %}
          <a class="btn btn-login" href="{{ url_for('logout') }}">Salir</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <main class="container mt-4">
    {% block body %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="copyright">© 2025 GymRats. Todos los derechos reservados.</div>
  </footer>

  <!-- JS: librerías -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.all.min.js"></script>

  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js" crossorigin="anonymous"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Tooltips + Toasts
      if (window.bootstrap) {
        document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));
        document.querySelectorAll('.toast').forEach(t => new bootstrap.Toast(t).show());
      }

      // Confirmación logout
      const logoutBtn = document.querySelector('a[href="{{ url_for("logout") }}"]');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function (e) {
          e.preventDefault();
          Swal.fire({
            title: '¿Está seguro que desea cerrar el sistema?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Sí, cerrar',
            cancelButtonText: 'Cancelar'
          }).then((r)=>{ if(r.isConfirmed) window.location.href = logoutBtn.href; });
        });
      }

      // Confirmaciones genéricas
      document.addEventListener('click', function (e) {
        const btn = e.target.closest('[data-confirm]');
        if (!btn) return;
        e.preventDefault();
        Swal.fire({
          title: btn.getAttribute('data-confirm') || '¿Desea continuar?',
          text: btn.getAttribute('data-confirm-text') || '',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: btn.getAttribute('data-confirm-ok') || 'Sí',
          cancelButtonText: btn.getAttribute('data-confirm-cancel') || 'Cancelar'
        }).then((r)=>{
          if (!r.isConfirmed) return;
          if (btn.tagName.toLowerCase() === 'a' && btn.href) { window.location.href = btn.href; return; }
          const form = btn.closest('form'); if (form) { form.submit(); return; }
          const url = btn.getAttribute('data-url'); if (url) { window.location.href = url; return; }
        });
      });
    });
  </script>
</body>
</html>