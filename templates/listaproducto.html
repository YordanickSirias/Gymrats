{% extends "baseadmin.html" %}

{% block title %}Lista de Productos{% endblock title %}

{% block body %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flashes">
  {% for category, message in messages %}
  <script type="text/javascript">
    (function(){
      if (!window.Swal) return;
      const Toast = Swal.mixin({
        toast: true, position: "top-end", showConfirmButton: false,
        timer: 2000, timerProgressBar: true,
        didOpen: (t)=>{ t.onmouseenter = Swal.stopTimer; t.onmouseleave = Swal.resumeTimer; }
      });
      Toast.fire({ icon: "success", title: "{{message}}" });
    })();
  </script>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}

<style>
  body{ background:linear-gradient(160deg,#0e0e10,#161618 55%,#1c1c1f); }
  .section-band{
    background:#1f1f21; border:1px solid #2a2a2a; color:#fff; border-radius:16px;
    box-shadow:0 10px 30px -12px rgba(0,0,0,.6);
  }
  .dark-card{
    background:#1f1f21; border:1px solid #2a2a2a; border-radius:18px; color:#e6e6e6;
    box-shadow:0 16px 34px -14px rgba(0,0,0,.45);
  }
  .admin-table{
    background:#1f1f21; border:1px solid #2a2a2a; border-radius:18px; overflow:hidden;
    box-shadow:0 16px 34px -14px rgba(0,0,0,.45);
  }
  .form-control, .form-select{
    background:#232325; border:1px solid #2d2d2d; color:#e6e6e6; height:44px;
  }
  .form-control::placeholder{ color:#a9a9ad; }
  .form-control:focus, .form-select:focus{
    background:#252527; color:#fff; border-color:#c40000; box-shadow:0 0 0 .15rem rgba(196,0,0,.3);
  }
  .admin-table thead th{
    background:linear-gradient(90deg,#7a0000,#c40000); color:#fff; border:none;
  }
  .admin-table tbody tr{ background:#1f1f21; color:#e6e6e6; }
  .admin-table tbody tr:hover{ background:#262628; }
  .admin-table td, .admin-table th{ border-color:#2a2a2a !important; }
  .btn-primary{
    background:linear-gradient(90deg,#7a0000,#c40000); border:none; color:#fff; font-weight:600;
    box-shadow:0 6px 16px -8px rgba(110,0,0,.55);
  }
  .btn-primary:hover{ background:linear-gradient(90deg,#c40000,#ff4d4d); transform:translateY(-1px); }
  .btn-outline-light{ border-color:#ff4d4d; color:#ff4d4d; }
  .btn-outline-light:hover{ background:#ff4d4d; color:#111; border-color:#ff4d4d; }
</style>

<div class="container mt-4">
  <div class="section-band p-4 mb-4 text-center">
    <h3 class="m-0">Lista de Productos</h3>
  </div>

  <div class="row g-4">
    <!-- Formulario agregar -->
    <div class="col-md-4">
      <div class="dark-card p-3 h-100">
        <h5 class="mb-3">Agregar Producto</h5>
        <form method="POST" action="{{ url_for('agregar_producto') }}">
          <div class="mb-3">
            <label class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control" name="nombre" placeholder="Ej: Creatina 300g" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Categoría</label>
            <input type="text" class="form-control" name="categoria" placeholder="Ej: Suplementos" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Precio</label>
            <input type="number" step="0.01" class="form-control" name="precio" placeholder="0.00" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripción</label>
            <textarea class="form-control" name="descripcion" rows="3" placeholder="Detalles del producto..."></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha</label>
            <input type="date" class="form-control" name="fecha">
          </div>
          <button type="submit" class="btn btn-primary w-100">Agregar Producto</button>
        </form>
      </div>
    </div>

    <!-- Tabla productos -->
    <div class="col-md-8">
      <div class="admin-table p-3">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 text-center">
            <thead>
              <tr>
                <th style="width:80px">#</th>
                <th>Nombre</th>
                <th>Categoría</th>
                <th style="width:140px">Precio</th>
                <th>Fecha</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              {% for producto in productos %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.categoria }}</td>
                <td>${{ '%.2f'|format((producto.precio or 0)|float) }}</td>
                <td>
                  {% if producto.fecha %}
                    {{ producto.fecha.strftime('%d/%m/%Y') if producto.fecha.strftime is defined else producto.fecha }}
                  {% else %}—{% endif %}
                </td>
                <td style="max-width:520px">{{ producto.descripcion }}</td>
              </tr>
              {% else %}
              <tr><td colspan="6" class="text-white-50">Sin registros.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.all.min.js"></script>
{% endblock %}